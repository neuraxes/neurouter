// Copyright 2024 Neurouter Authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package neurouter.v1;

import "google/api/annotations.proto";
import "neurouter/v1/common.proto";
import "neurouter/v1/content.proto";

option go_package = "github.com/neuraxes/neurouter/api/neurouter/v1;v1";

service Chat {
  rpc Chat(ChatReq) returns (ChatResp) {
    option (google.api.http) = {
      get: "/v1/chat"
    };
  }
  rpc ChatStream(ChatReq) returns (stream ChatResp) {}
}

enum Role {
  SYSTEM = 0;
  USER = 1;
  MODEL = 2;
}

enum ChatStatus {
  // The model is generating the response
  CHAT_IN_PROGRESS = 0;
  // The model turn has been successfully completed
  CHAT_COMPLETED = 1;
  // The generation has been refused
  CHAT_REFUSED = 2;
  // The generation has been cancelled
  CHAT_CANCELLED = 3;
  // The generation stopped due to exceeding token limit
  CHAT_REACHED_TOKEN_LIMIT = 5;
  // The generation stopped due to pending tool uses
  CHAT_PENDING_TOOL_USE = 4;
}

message Message {
  // The unique identifier of the message
  string id = 1;
  // The role of the message sender
  Role role = 2;
  // The multi-modality content
  repeated Content contents = 4;
  // The optional name of the message sender
  string name = 5;
}

message ChatReq {
  // The unique identifier of the chat
  string id = 1;
  // The requested model to use
  string model = 2;
  // The generation configuration
  GenerationConfig config = 3;
  // The conversation history
  repeated Message messages = 4;
  // The tools available for the model to use
  repeated Tool tools = 5;
}

message ChatResp {
  // The unique identifier of the chat
  string id = 1;
  // The model used to generate the response
  string model = 2;
  // The status of the response
  ChatStatus status = 3;
  // The generated message
  Message message = 4;
  // The statistics for the generation
  Statistics statistics = 5;
}
